<div class="app-wrapper">
  <!-- Sidebar Backdrop for Mobile -->
  <div
    class="sidebar-backdrop"
    *ngIf="isMobile && isSidebarOpen"
    (click)="closeSidebar()"
  ></div>

  <!-- Sidebar -->
  <aside
    class="app-sidebar vibrant-sidebar"
    [class.collapsed]="isSidebarCollapsed && !isMobile"
    [class.open]="isSidebarOpen || !isMobile"
    role="navigation"
  >
    <div
      class="sidebar-header d-flex justify-content-between align-items-center px-3 py-3"
    >
      <div class="logo-container d-flex align-items-center">
        <span
          *ngIf="!isSidebarCollapsed || isMobile"
          class="logo-text text-dark fw-bold fs-4 text-decoration-none"
        >
          Goceng
        </span>
        <span class="logo-img-container d-flex align-items-center ms-2">
          <img
            src="../../../assets/dashtrap/images/logo/Base.png"
            alt="Goceng Logo"
            class="logo-img"
          />
        </span>
      </div>

      <!-- Hamburger Button for Sidebar Collapse -->
      <button
        class="btn btn-outline-secondary text-dark d-sm-none"
        (click)="toggleSidebar()"
        aria-label="Toggle sidebar"
      >
        <i
          class="bi"
          [ngClass]="{
            'bi-list': !isSidebarCollapsed || isMobile,
            'bi-x': isSidebarCollapsed && !isMobile
          }"
        ></i>
      </button>

      <!-- Mobile Close Button -->
      <button
        *ngIf="isMobile"
        class="btn btn-sm text-white"
        aria-label="Close sidebar"
        (click)="closeSidebar()"
      >
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

<!-- Sidebar Navigation -->
<ul class="menu-list list-unstyled px-2">
  <li *ngFor="let item of menuItems" class="menu-item mb-2">
    <!-- With Children (Dropdown) -->
    <ng-container *ngIf="item.children && item.children.length > 0; else singleLink">
      <div
        class="menu-link d-flex align-items-center justify-content-between"
        (click)="toggleSubMenu(item)"
        role="button"
        [attr.aria-expanded]="item.expanded ? 'true' : 'false'"
        [attr.aria-label]="'Toggle submenu for ' + item.label"
      >
        <div class="d-flex align-items-center">
          <i class="bi me-2" [ngClass]="item.icon"></i>
          <span *ngIf="!isSidebarCollapsed || isMobile">
            {{ item.label }}
          </span>
        </div>

        <!-- Show chevron only when sidebar is not collapsed -->
        <i
          *ngIf="!isSidebarCollapsed"
          class="bi transition"
          [ngClass]="{
            'bi-chevron-down': !item.expanded,
            'bi-chevron-up': item.expanded
          }"
          [style.transform]="item.expanded ? 'rotate(180deg)' : 'rotate(0)'"
        ></i>
      </div>

      <!-- Submenu (Only show if sidebar is not collapsed and item.expanded is true) -->
      <ul
        class="submenu list-unstyled ps-4 mt-1"
        *ngIf="!isSidebarCollapsed && item.expanded"
        [@.disabled]="isSidebarCollapsed && !isMobile"
      >
        <li *ngFor="let child of item.children" class="menu-item mb-1">
          <a
            [routerLink]="child.route"
            routerLinkActive="active"
            class="menu-link d-flex align-items-center"
          >
            <i class="bi me-2" [ngClass]="child.icon"></i>
            <span *ngIf="!isSidebarCollapsed || isMobile">
              {{ child.label }}
            </span>
          </a>
        </li>
      </ul>
    </ng-container>

    <!-- Single Item -->
    <ng-template #singleLink>
      <a
        [routerLink]="item.route"
        routerLinkActive="active"
        class="menu-link d-flex align-items-center"
      >
        <i class="bi me-2" [ngClass]="item.icon"></i>
        <span *ngIf="!isSidebarCollapsed || isMobile">
          {{ item.label }}
        </span>
      </a>
    </ng-template>
  </li>
</ul>

  </aside>

  <!-- Main Content -->
  <main
    class="app-main-content bg-dashboard"
    [class.collapsed]="isSidebarCollapsed && !isMobile"
  >
    <!-- Top Bar -->
    <header
      class="app-header navbar-style-1 shadow-sm px-4 py-3 d-flex justify-content-between align-items-center bg-white border-bottom"
    >
      <button
        class="btn btn-outline-secondary text-dark"
        (click)="toggleSidebar()"
        aria-label="Toggle sidebar"
      >
        <i
          class="bi"
          [ngClass]="{
            'bi-list': !isSidebarCollapsed || isMobile,
            'bi-x': isSidebarCollapsed && !isMobile
          }"
        ></i>
      </button>

      <!-- User Info -->
      <div
        class="d-flex flex-column flex-sm-row align-items-start align-items-sm-center"
      >
        <span class="fw-bold me-3" style="color: #333;">{{ userName }}</span>
        <small class="text-muted" style="color: #555;">{{ formatRole(userRole) }}</small>
        <button
          class="btn btn-danger btn-sm mt-2 mt-sm-0 ms-sm-3"
          (click)="logout()"
        >
          Logout
        </button>
      </div>
    </header>

    <!-- Dashboard Section -->
    <section class="section dashboard p-4">
      <!-- Stats Cards -->
      <div class="row">
        <div
          class="col-lg-3 col-md-6 mb-3"
          *ngFor="let stat of dashboardStats"
        >
          <div class="card shadow-sm border-0">
            <div class="card-body text-center">
              <h5 class="card-title text-muted">{{ stat.title }}</h5>
              <p class="fs-3" [ngClass]="stat.color">{{ stat.value }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Applications -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <h5 class="card-title text-muted">Recent Applications</h5>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Customer</th>
                    <th>Loan Amount</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let application of recentApplications">
                    <td>{{ application.id }}</td>
                    <td>{{ application.customer }}</td>
                    <td>{{ application.loanAmount | currency }}</td>
                    <td>{{ application.status }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>
