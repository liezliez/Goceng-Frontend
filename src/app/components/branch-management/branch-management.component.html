<div class="dashboard-background">
  <div class="dashboard-container px-3 py-2">
    <div class="card shadow-lg rounded-4 border-0 bg-white">
      <div class="card-body px-4 py-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="fw-bold mb-0">Branch Management</h2>
          <button class="btn btn-primary" (click)="openModal(branchModal)">+ Add Branch</button>
        </div>

        <input
          type="text"
          class="form-control mb-3"
          placeholder="Search by name, city, or province..."
          [(ngModel)]="searchText" />

        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Name</th>
                <th>Address</th>
                <th>City</th>
                <th>Province</th>
                <th>Latitude</th>
                <th>Longitude</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let branch of paginatedBranches">
                <td>{{ branch.name }}</td>
                <td>{{ branch.address }}</td>
                <td>{{ branch.city }}</td>
                <td>{{ branch.province }}</td>
                <td>{{ branch.latitude }}</td>
                <td>{{ branch.longitude }}</td>
                <td>
                  <button class="btn btn-warning btn-sm me-2" (click)="openModal(branchModal, branch)">
                    <i class="bi bi-pencil-fill"></i> Edit
                  </button>
                  <button class="btn btn-danger btn-sm" (click)="deleteBranch(branch.id)">
                    <i class="bi bi-trash-fill"></i> Delete
                  </button>
                </td>
              </tr>
              <tr *ngIf="paginatedBranches.length === 0">
                <td colspan="7" class="text-center">No branches found.</td>
              </tr>
            </tbody>
          </table>
        </div>

        <nav class="mt-3">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button class="page-link" (click)="changePage(currentPage - 1)">Previous</button>
            </li>
            <li
              *ngFor="let _ of [].constructor(totalPages()); let i = index"
              [class.active]="currentPage === i + 1"
              class="page-item"
            >
              <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
            </li>
            <li class="page-item" [class.disabled]="currentPage === totalPages()">
              <button class="page-link" (click)="changePage(currentPage + 1)">Next</button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

<ng-template #branchModal>
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">{{ selectedBranch ? 'Edit' : 'Create' }} Branch</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="modalService.dismissAll()"></button>
    </div>
    <div class="modal-body">
      <form [formGroup]="branchForm" novalidate>
        <div class="mb-3" *ngFor="let field of ['name', 'address', 'city', 'province', 'latitude', 'longitude']">
          <label [for]="field" class="form-label text-capitalize">{{ field }}</label>
          <input
            [id]="field"
            [formControlName]="field"
            type="text"
            class="form-control"
            [attr.placeholder]="field" />
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="modalService.dismissAll()">Cancel</button>
      <button class="btn btn-primary" (click)="saveBranch()">Save</button>
    </div>
  </div>
</ng-template>
